<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/favicon.png">
  <title>Ralph CLI - Chat</title>
  <link rel="stylesheet" href="/css/rams-ui.css">
  <script src="/js/htmx.min.js"></script>
  <style>
    /* Chat Container Layout */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 220px);
      max-width: 900px;
      margin: 0 auto;
    }

    /* Chat Header */
    .chat-header {
      text-align: center;
      padding: var(--rams-space-6);
      border-bottom: var(--rams-border-width) solid var(--rams-border-color);
    }
    .chat-header p {
      color: var(--rams-gray-500);
      font-size: var(--rams-text-sm);
      margin-top: var(--rams-space-2);
    }

    /* Chat Messages Area */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: var(--rams-space-6);
      display: flex;
      flex-direction: column;
      gap: var(--rams-space-4);
    }

    /* Individual Message */
    .chat-message {
      display: flex;
      gap: var(--rams-space-3);
      max-width: 80%;
    }
    .chat-message.user {
      align-self: flex-end;
      flex-direction: row-reverse;
    }
    .chat-message.assistant {
      align-self: flex-start;
    }

    /* Avatar */
    .chat-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--rams-accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
      flex-shrink: 0;
      font-size: var(--rams-text-sm);
    }
    .chat-message.user .chat-avatar {
      background: var(--rams-gray-600);
    }

    /* Message Bubble */
    .chat-bubble {
      background: var(--rams-gray-50);
      border: var(--rams-border-width) solid var(--rams-border-color);
      border-radius: var(--rams-radius-lg);
      padding: var(--rams-space-3) var(--rams-space-4);
      line-height: var(--rams-leading-relaxed);
      font-size: var(--rams-text-sm);
    }
    .chat-message.user .chat-bubble {
      background: var(--rams-accent);
      color: white;
      border-color: var(--rams-accent);
    }
    .chat-bubble code {
      font-family: var(--rams-font-mono);
      font-size: var(--rams-text-xs);
      background: rgba(0, 0, 0, 0.06);
      padding: 2px 6px;
      border-radius: var(--rams-radius-sm);
    }
    .chat-message.user .chat-bubble code {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Input Container */
    .chat-input-container {
      padding: var(--rams-space-6);
      border-top: var(--rams-border-width) solid var(--rams-border-color);
      background: var(--rams-gray-50);
    }
    .chat-input-form {
      display: flex;
      gap: var(--rams-space-3);
      max-width: 800px;
      margin: 0 auto;
    }
    .chat-input-form .rams-input {
      flex: 1;
    }

    /* Quick Actions */
    .quick-actions {
      display: flex;
      flex-wrap: wrap;
      gap: var(--rams-space-2);
      margin-top: var(--rams-space-4);
      justify-content: center;
    }
    .quick-actions .rams-btn {
      border-radius: 999px;
      font-size: var(--rams-text-xs);
      padding: var(--rams-space-2) var(--rams-space-4);
    }

    /* Welcome Message */
    .welcome-message {
      text-align: center;
      padding: var(--rams-space-6);
      color: var(--rams-gray-500);
    }
    .welcome-message p {
      margin-top: var(--rams-space-2);
    }

    /* Capabilities Grid */
    .capabilities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--rams-space-4);
      margin-top: var(--rams-space-6);
      padding: 0 var(--rams-space-4);
    }
    .capability-card {
      text-align: left;
      padding: var(--rams-space-4);
    }
    .capability-card .rams-label {
      margin-bottom: var(--rams-space-1);
      display: block;
    }
    .capability-card p {
      color: var(--rams-gray-500);
      font-size: var(--rams-text-xs);
      line-height: 1.4;
      margin: 0;
    }
    .capability-icon {
      font-size: 1.5rem;
      margin-bottom: var(--rams-space-2);
    }
  </style>
</head>
<body class="rams-page">

  <!-- Persistent Sidebar -->
  <aside class="rams-sidebar">
    <div class="rams-sidebar-header">
      <div class="rams-logo">
        <div class="rams-logo-mark"></div>
        <span class="rams-logo-text">RALPH</span>
      </div>
    </div>

    <nav class="rams-nav">
      <div class="rams-nav-section">
        <div class="rams-nav-label">Main</div>
        <ul class="rams-nav-items">
          <li><a href="/" class="rams-nav-link">Home</a></li>
          <li><a href="/dashboard.html" class="rams-nav-link">Dashboard</a></li>
          <li><a href="/streams.html" class="rams-nav-link">Streams</a></li>
          <li><a href="/docs/" class="rams-nav-link">Documentation</a></li>
        </ul>
      </div>

      <div class="rams-nav-section">
        <div class="rams-nav-label">Monitoring</div>
        <ul class="rams-nav-items">
          <li><a href="/logs.html" class="rams-nav-link">Logs</a></li>
          <li><a href="/tokens.html" class="rams-nav-link">Tokens</a></li>
          <li><a href="/trends.html" class="rams-nav-link">Trends</a></li>
        </ul>
      </div>

      <div class="rams-nav-section">
        <div class="rams-nav-label">Tools</div>
        <ul class="rams-nav-items">
          <li><a href="/editor.html" class="rams-nav-link">Editor</a></li>
          <li><a href="/chat.html" class="rams-nav-link active">Chat</a></li>
        </ul>
      </div>

      <div class="rams-nav-section">
        <div class="rams-nav-label">Advanced</div>
        <ul class="rams-nav-items">
          <li><a href="/docs/agent-guide.html" class="rams-nav-link">Agent Guide</a></li>
        </ul>
      </div>
    </nav>

    <div class="rams-sidebar-footer">
      <div class="rams-version">v1.0.0</div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="rams-main">

    <!-- Top Bar -->
    <div class="rams-topbar">
      <div class="rams-breadcrumb">
        <span class="rams-breadcrumb-current">Chat</span>
      </div>
    </div>

    <!-- Content Area -->
    <article class="rams-content">

      <div class="chat-container">
        <div class="chat-header">
          <h2 class="rams-h2">Chat with Ralph</h2>
          <p>Ask questions about your project, get help with PRDs, or discuss implementation strategies.</p>
        </div>

        <div class="chat-messages" id="chat-messages">
          <div class="welcome-message">
            <h3 class="rams-h3">Welcome to Ralph Chat</h3>
            <p>I can help you with PRD creation, planning, troubleshooting, and more.</p>

            <div class="capabilities-grid">
              <div class="rams-card capability-card">
                <div class="capability-icon">&#128221;</div>
                <span class="rams-label">PRD Assistance</span>
                <p>Help writing and refining your Product Requirements Documents</p>
              </div>
              <div class="rams-card capability-card">
                <div class="capability-icon">&#128203;</div>
                <span class="rams-label">Planning Help</span>
                <p>Break down features into actionable user stories</p>
              </div>
              <div class="rams-card capability-card">
                <div class="capability-icon">&#128295;</div>
                <span class="rams-label">Troubleshooting</span>
                <p>Diagnose and fix issues with builds, streams, or git</p>
              </div>
              <div class="rams-card capability-card">
                <div class="capability-icon">&#128161;</div>
                <span class="rams-label">Best Practices</span>
                <p>Get tips on using Ralph more effectively</p>
              </div>
            </div>
          </div>

          <div class="chat-message user">
            <div class="chat-avatar">U</div>
            <div class="chat-bubble">How do I start a new PRD?</div>
          </div>

          <div class="chat-message assistant">
            <div class="chat-avatar">R</div>
            <div class="chat-bubble">
              To create a new PRD, run <code>ralph prd "Your feature description"</code> in your terminal. This will generate a structured PRD in <code>.ralph/PRD-N/prd.md</code>.<br><br>
              For example:<br>
              <code>ralph prd "Add user authentication with OAuth"</code><br><br>
              You can then edit the generated PRD to add more details, acceptance criteria, and user stories.
            </div>
          </div>
        </div>

        <div class="chat-input-container">
          <form class="chat-input-form" id="chat-form" onsubmit="handleChatSubmit(event)">
            <input
              type="text"
              class="rams-input"
              id="chat-input"
              placeholder="Ask Ralph a question..."
              autocomplete="off"
            />
            <button type="submit" class="rams-btn rams-btn-primary" id="send-btn">
              Send
            </button>
          </form>
          <div class="quick-actions">
            <button class="rams-btn rams-btn-secondary" onclick="insertQuickAction('How do I create a new PRD?')">Create PRD</button>
            <button class="rams-btn rams-btn-secondary" onclick="insertQuickAction('How do I run a build?')">Run Build</button>
            <button class="rams-btn rams-btn-secondary" onclick="insertQuickAction('How do I use streams for parallel development?')">Use Streams</button>
            <button class="rams-btn rams-btn-secondary" onclick="insertQuickAction('What commands are available?')">Show Commands</button>
          </div>
        </div>
      </div>

    </article>

  </main>

  <script>
    function insertQuickAction(text) {
      var input = document.getElementById("chat-input");
      input.value = text;
      input.focus();
    }

    function handleChatSubmit(event) {
      event.preventDefault();
      var input = document.getElementById("chat-input");
      var message = input.value.trim();

      if (!message) return;

      addMessage(message, "user");
      input.value = "";

      setTimeout(function() {
        var response = generateResponse(message);
        addMessage(response, "assistant");
      }, 1000 + Math.random() * 1000);
    }

    function addMessage(text, type) {
      var messagesContainer = document.getElementById("chat-messages");
      var welcomeMessage = messagesContainer.querySelector(".welcome-message");
      if (welcomeMessage) {
        welcomeMessage.style.display = "none";
      }

      var messageDiv = document.createElement("div");
      messageDiv.className = "chat-message " + type;

      var avatar = document.createElement("div");
      avatar.className = "chat-avatar";
      avatar.textContent = type === "user" ? "U" : "R";

      var bubble = document.createElement("div");
      bubble.className = "chat-bubble";
      bubble.innerHTML = text;

      messageDiv.appendChild(avatar);
      messageDiv.appendChild(bubble);
      messagesContainer.appendChild(messageDiv);

      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function generateResponse(message) {
      var lowerMessage = message.toLowerCase();

      if (lowerMessage.includes("prd") && (lowerMessage.includes("create") || lowerMessage.includes("new"))) {
        return 'To create a new PRD, use:<br><br><code>ralph prd "Your feature description"</code><br><br>This creates a structured PRD in <code>.ralph/PRD-N/prd.md</code>. You can then edit it to add acceptance criteria and user stories.';
      }

      if (lowerMessage.includes("build") && (lowerMessage.includes("run") || lowerMessage.includes("start"))) {
        return 'To run a build, use:<br><br><code>ralph build N</code><br><br>Where N is the number of iterations. For example, <code>ralph build 5</code> runs 5 iterations.<br><br>Options:<br>- <code>--prd=N</code> - Target a specific PRD<br>- <code>--no-commit</code> - Dry run without commits<br>- <code>--agent=claude</code> - Choose the agent';
      }

      if (lowerMessage.includes("stream")) {
        return 'Streams allow parallel development on multiple PRDs:<br><br>1. <strong>List PRDs:</strong> <code>ralph stream list</code><br>2. <strong>Init worktree:</strong> <code>ralph stream init N</code><br>3. <strong>Build in stream:</strong> <code>ralph stream build N 5</code><br>4. <strong>Merge when done:</strong> <code>ralph stream merge N</code><br><br>Run multiple streams in parallel with: <code>ralph stream build 1 & ralph stream build 2 &</code>';
      }

      if (lowerMessage.includes("command")) {
        return 'Core Ralph commands:<br><br><strong>Setup:</strong><br>- <code>ralph install</code> - Install Ralph to project<br><br><strong>PRD Workflow:</strong><br>- <code>ralph prd "desc"</code> - Create PRD<br>- <code>ralph plan</code> - Create plan from PRD<br>- <code>ralph build N</code> - Run N iterations<br><br><strong>Streams:</strong><br>- <code>ralph stream list</code> - List PRDs<br>- <code>ralph stream status</code> - Show status<br>- <code>ralph stream build N M</code> - Build PRD N with M iterations';
      }

      if (lowerMessage.includes("help") || lowerMessage.includes("stuck")) {
        return 'Here are some things I can help with:<br><br>- Creating and editing PRDs<br>- Understanding Ralph commands<br>- Troubleshooting build issues<br>- Using streams for parallel work<br>- Best practices and tips<br><br>What would you like to know more about?';
      }

      return 'I can help with PRD creation, builds, streams, and troubleshooting. Try asking:<br><br>- "How do I create a new PRD?"<br>- "How do I run a build?"<br>- "How do I use streams?"<br>- "What commands are available?"';
    }
  </script>
</body>
</html>
