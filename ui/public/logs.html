<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/favicon.png">
  <title>Ralph CLI - Logs</title>
  <link rel="stylesheet" href="/css/rams-ui.css">
  <script src="/js/htmx.min.js"></script>
</head>
<body class="rams-page">

  <!-- Persistent Sidebar -->
  <aside class="rams-sidebar">
    <div class="rams-sidebar-header">
      <div class="rams-logo">
        <div class="rams-logo-mark"></div>
        <span class="rams-logo-text">RALPH</span>
      </div>
    </div>

    <nav class="rams-nav">
      <div class="rams-nav-section">
        <div class="rams-nav-label">Main</div>
        <ul class="rams-nav-items">
          <li><a href="/" class="rams-nav-link">Home</a></li>
          <li><a href="/dashboard.html" class="rams-nav-link">Dashboard</a></li>
          <li><a href="/streams.html" class="rams-nav-link">Streams</a></li>
          <li><a href="/docs/" class="rams-nav-link">Documentation</a></li>
        </ul>
      </div>

      <div class="rams-nav-section">
        <div class="rams-nav-label">Monitoring</div>
        <ul class="rams-nav-items">
          <li><a href="/logs.html" class="rams-nav-link active">Logs</a></li>
          <li><a href="/tokens.html" class="rams-nav-link">Tokens</a></li>
          <li><a href="/trends.html" class="rams-nav-link">Trends</a></li>
        </ul>
      </div>

      <div class="rams-nav-section">
        <div class="rams-nav-label">Tools</div>
        <ul class="rams-nav-items">
          <li><a href="/editor.html" class="rams-nav-link">Editor</a></li>
          <li><a href="/chat.html" class="rams-nav-link">Chat</a></li>
        </ul>
      </div>

      <div class="rams-nav-section">
        <div class="rams-nav-label">Advanced</div>
        <ul class="rams-nav-items">
          <li><a href="/docs/agent-guide.html" class="rams-nav-link">Agent Guide</a></li>
        </ul>
      </div>
    </nav>

    <div class="rams-sidebar-footer">
      <div class="rams-version">v1.0.0</div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="rams-main">

    <!-- Top Bar -->
    <div class="rams-topbar">
      <div class="rams-breadcrumb">
        <span class="rams-breadcrumb-current">Logs</span>
      </div>
      <div class="rams-topbar-actions">
        <select
          id="stream-filter"
          class="rams-select"
          style="width: auto; min-width: 150px;"
          name="streamId"
        >
          <option value="">Default (latest)</option>
        </select>
        <script>
          // Load stream options on page load
          document.addEventListener('DOMContentLoaded', function() {
            var streamSelect = document.getElementById('stream-filter');

            // Fetch stream options
            fetch('/api/partials/stream-options')
              .then(response => response.text())
              .then(html => {
                streamSelect.innerHTML = html;
                // Trigger initial load of logs with latest stream
                triggerLogsRefresh();
              });

            // Setup change listener
            streamSelect.addEventListener('change', function() {
              triggerLogsRefresh();
            });
          });

          function triggerLogsRefresh() {
            var streamFilter = document.getElementById('stream-filter');
            var levelFilter = document.getElementById('level-filter');
            var logsContainer = document.getElementById('logs-container');
            var indicator = document.getElementById('logs-indicator');

            // Show loading indicator
            indicator.classList.add('htmx-swapping');

            // Build query params
            var params = new URLSearchParams();
            if (streamFilter.value) params.append('streamId', streamFilter.value);
            if (levelFilter.value) params.append('level', levelFilter.value);

            // Fetch activity logs
            fetch('/api/partials/activity-logs?' + params.toString())
              .then(response => response.text())
              .then(html => {
                logsContainer.innerHTML = html;
                indicator.classList.remove('htmx-swapping');
              })
              .catch(error => {
                console.error('Error loading logs:', error);
                indicator.classList.remove('htmx-swapping');
              });

            // Also trigger terminal commands refresh
            var terminalCommands = document.getElementById('terminal-commands');
            var terminalParams = new URLSearchParams();
            if (streamFilter.value) terminalParams.append('streamId', streamFilter.value);

            fetch('/api/partials/terminal-commands?' + terminalParams.toString())
              .then(response => response.text())
              .then(html => {
                terminalCommands.innerHTML = html;
              });

            // Also trigger recent runs refresh
            var runsContainer = document.getElementById('runs-container');
            var runsParams = new URLSearchParams();
            if (streamFilter.value) runsParams.append('streamId', streamFilter.value);

            fetch('/api/partials/recent-runs?' + runsParams.toString())
              .then(response => response.text())
              .then(html => {
                runsContainer.innerHTML = html;
              });
          }
        </script>
        <select
          id="level-filter"
          class="rams-select"
          style="width: auto; min-width: 130px;"
          name="level"
        >
          <option value="">All Levels</option>
          <option value="error">Errors Only</option>
          <option value="warning">Warnings & Errors</option>
          <option value="info">Info & Above</option>
        </select>
        <script>
          // Setup level filter change listener
          document.addEventListener('DOMContentLoaded', function() {
            var levelFilter = document.getElementById('level-filter');
            levelFilter.addEventListener('change', function() {
              triggerLogsRefresh();
            });
          });
        </script>
      </div>
    </div>

    <!-- Content Area -->
    <article class="rams-content">

      <!-- Terminal Commands Section -->
      <section class="rams-section">
        <div id="terminal-commands">
          <div class="rams-loading">
            <span class="rams-spinner"></span> Loading terminal commands...
          </div>
        </div>
      </section>

      <!-- Activity Logs Section -->
      <section class="rams-section">
        <div class="rams-section-header">
          <h2 class="rams-h2">
            Activity Logs
            <span class="htmx-indicator" id="logs-indicator">
              <span class="rams-spinner"></span>
            </span>
          </h2>
        </div>
        <div id="logs-container">
          <div class="rams-loading">
            <span class="rams-spinner"></span> Loading activity logs...
          </div>
        </div>
        <script>
          // Auto-refresh logs every 2 seconds
          setInterval(function() {
            if (typeof triggerLogsRefresh !== 'undefined') {
              triggerLogsRefresh();
            }
          }, 2000);
        </script>
      </section>

      <!-- Recent Runs Section -->
      <section class="rams-section">
        <div class="rams-section-header">
          <h2 class="rams-h2">Recent Runs</h2>
        </div>
        <div id="runs-container">
          <div class="rams-loading">
            <span class="rams-spinner"></span> Loading recent runs...
          </div>
        </div>
        <script>
          // Auto-refresh recent runs every 5 seconds
          setInterval(function() {
            var streamFilter = document.getElementById('stream-filter');
            var runsContainer = document.getElementById('runs-container');

            var params = new URLSearchParams();
            if (streamFilter && streamFilter.value) {
              params.append('streamId', streamFilter.value);
            }

            fetch('/api/partials/recent-runs?' + params.toString())
              .then(response => response.text())
              .then(html => {
                runsContainer.innerHTML = html;
              })
              .catch(error => {
                console.error('Error loading recent runs:', error);
              });
          }, 5000);
        </script>
      </section>

    </article>

  </main>

</body>
</html>
